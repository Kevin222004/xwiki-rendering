.#-----------------------------------------------------
.inputexpect|xwiki/2.0
.# Verify support for the figure caption syntax with nested link and list.
.#-----------------------------------------------------
[[Image **Caption**>>image:my.png||param1="value1" param2="value2"]]

[[Caption

* With
* nested
* list [[and link>>https://xwiki.com]].>>image:Space.ExistingPage@my.png]]
.#-----------------------------------------------------
.expect|event/1.0
.#-----------------------------------------------------
beginDocument
beginFigure [[class]=[image]]
onImage [Typed = [false] Type = [attach] Reference = [my.png]] [false] [[param1]=[value1][param2]=[value2]]
beginFigureCaption
beginParagraph
onWord [Image]
onSpace
beginFormat [BOLD]
onWord [Caption]
endFormat [BOLD]
endParagraph
endFigureCaption
endFigure [[class]=[image]]
beginFigure [[class]=[image]]
onImage [Typed = [false] Type = [attach] Reference = [Space.ExistingPage@my.png]] [false]
beginFigureCaption
beginParagraph
onWord [Caption]
endParagraph
beginList [BULLETED]
beginListItem
onWord [With]
endListItem
beginListItem
onWord [nested]
endListItem
beginListItem
onWord [list]
onSpace
beginLink [Typed = [false] Type = [url] Reference = [https://xwiki.com]] [false]
onWord [and]
onSpace
onWord [link]
endLink [Typed = [false] Type = [url] Reference = [https://xwiki.com]] [false]
onSpecialSymbol [.]
endListItem
endList [BULLETED]
endFigureCaption
endFigure [[class]=[image]]
endDocument
.#-----------------------------------------------------
.expect|xhtml/1.0
.#-----------------------------------------------------
<img src="imageurl" param1="value1" param2="value2" alt="my.png"/><div class="figcaption"><p>Image <strong>Caption</strong></p></div><img src="imageurl" alt="Space.ExistingPage@my.png"/><div class="figcaption"><p>Caption</p><ul><li>With</li><li>nested</li><li>list <span class="wikiexternallink"><a href="https://xwiki.com">and link</a></span>.</li></ul></div>
.#-----------------------------------------------------
.expect|html/5.0
.#-----------------------------------------------------
<figure class="image"><img src="imageurl" param1="value1" param2="value2" alt="my.png"/><figcaption><p>Image <strong>Caption</strong></p></figcaption></figure><figure class="image"><img src="imageurl" alt="Space.ExistingPage@my.png"/><figcaption><p>Caption</p><ul><li>With</li><li>nested</li><li>list <span class="wikiexternallink"><a href="https://xwiki.com">and link</a></span>.</li></ul></figcaption></figure>
